#!/bin/sh

VERSION=1.23.4
CHECKSUM=$(wget -q -O- "https://go.dev/dl/?mode=json" | grep -A 4 "go${VERSION}.linux-amd64.tar.gz" | grep "sha256" | awk -F\" '{print $4}')

cd ~/downloads
wget "https://go.dev/dl/go${VERSION}.linux-amd64.tar.gz"

echo "Checking file integrity..."
echo "${CHECKSUM} go${VERSION}.linux-amd64.tar.gz" | sha256sum -c 2>&1 | grep OK

if [ $? -eq 0 ]; then
    echo "Removing old version of go..."
    sudo rm -rf /usr/local/go

    echo "Downloading go${VERSION}..."
    sudo tar -C /usr/local -xzf go${VERSION}.linux-amd64.tar.gz

    echo "Go updated to version ${VERSION}..."
    rm go${VERSION}.linux-amd64.tar.gz
    go version
else
    echo "File integrity checksum failed! Exiting..."
fi
